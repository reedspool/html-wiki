<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Sitemap</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <style>
      site-map {
        ul {
          list-style-position: inside;
          list-style-type: none;
          line-height: 1.2em; /* Empirically largest w no gap */
          padding-inline-start: 0;
          & ul {
            & li {
              padding-inline-start: 1rem;
              &:last-child {
              }
            }
          }
        }
      }
    </style>
    <p>Ordered by directory structure</p>
    <site-map>
      <drop-if truthy="true">
        This is always dropped, unless `rootSelector: 'template-'`. So this
        works with no custom DOM manipulation. Will probably make it a
        first-level thing at some point.
        <ul id="my-template-li">
          <map-list
            q="Object.entries(directoryContents).map(([dir, contents]) => ({ dir, contents, fileDetails: typeof contents === 'string' && fileCache.getByContentPath(contents) }))"
          >
            <li>
              <keep-if truthy="typeof currentListItem.contents === 'string'">
                <set-
                  ipath="currentListItem.contents, goodHref"
                  iname="or(currentListItem.fileDetails?.meta?.title,currentListItem.fileDetails.name)"
                >
                </set->
                <a x-href=" ipath" x-content="iname"></a>
                <drop-if truthy="parameters.static !== undefined">
                  -
                  <a x-href="`${ipath}?edit`" x-title="`Edit ${iname}`">Edit</a>
                </drop-if>
              </keep-if>
              <drop-if truthy="typeof currentListItem.contents === 'string'">
                <details>
                  <summary x-content="`/${currentListItem.dir}/`"></summary>
                  <ul>
                    <query-content
                      q="render(contentPath, {...parameters, rootSelector: '#my-template-li', directoryContents: currentListItem.contents, contentPath })"
                    >
                    </query-content>
                  </ul>
                </details>
              </drop-if>
            </li>
          </map-list>
        </ul>
      </drop-if>
      <ul>
        <li>
          <a href="/">/</a>
          <query-content
            q="render(contentPath, {...parameters, rootSelector: '#my-template-li', directoryContents: (await site.fileTree), contentPath })"
          >
          </query-content>
        </li>
      </ul>
    </site-map>
  </body>
</html>
