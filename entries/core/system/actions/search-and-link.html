<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <keep-if truthy="parameters.dialog!==undefined">
      <meta itemprop="nocontainer" />
    </keep-if>
    <title>Search and Link</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <keep-if truthy="parameters.dialog!==undefined">
      <link
        rel="stylesheet"
        href="/system/global.css"
        type="text/css"
        media="screen"
      />

      <style>
        :root {
          font-size: 14px;
        }
        body {
          padding: var(--space-half);
          box-sizing: border-box;
        }
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          margin-block: var(--space-half);
          font-size: 1rem;
          font-weight: bold;
        }
      </style>
    </keep-if>

    <style>
      textarea {
        height: 3rem;
      }

      [copy-target-container]:has([copy]:hover) {
        [copy-target] {
          background-color: var(--bg-lighter);
        }
      }

      li:not(:last-child) {
        margin-bottom: var(--space-half);
      }

      ul {
        list-style: none;
      }
    </style>
    <script src="/system/scripts/copy-and-insert.js"></script>
    <form method="GET">
      <keep-if truthy="parameters.dialog!==undefined">
        <input type="hidden" name="select" value="body" />
        <input type="hidden" name="dialog" value="dialog" />
        <input
          type="hidden"
          name="contentPath"
          x-value="parameters.contentPath"
        />
      </keep-if>
      <textarea
        autofocus
        name="query"
        x-content="or(parameters.query,'')"
        placeholder="Search here"
      >
      </textarea>
      <button type="submit" x-formaction="parameters.contentPath">Go</button>
    </form>
    <keep-if truthy="parameters.query!==undefined">
      <set- result="site.search(parameters.query.trim())"> </set->
      <h2>Results</h2>
      <ul>
        <map-list q="parameters.result" allow-one>
          <set-
            ipath="parameters.currentListItem.contentPath"
            ititle="or(parameters.currentListItem.meta.title,parameters.currentListItem.name)"
            iname="parameters.currentListItem.name"
            markdown-link='`[${parameters.ititle}](<${parameters.ipath}> "${parameters.iname}")`'
            html-link='`<a href="${parameters.ipath}" title="${parameters.ititle}">${parameters.iname}</a>`'
          >
          </set->
          <li copy-target-container>
            <div class="flex-row justify-between">
              <keep-if truthy="parameters.dialog===undefined">
                <span>
                  <a
                    copy-target
                    x-href="parameters.ipath"
                    x-title="parameters.iname"
                    x-content="parameters.ititle"
                  />
                  -
                  <a
                    copy-target
                    x-href="`${parameters.ipath}?edit`"
                    x-title="`Edit ${parameters.iname}`"
                    >Edit</a
                  >
                </span>
              </keep-if>
              <keep-if truthy="parameters.dialog!==undefined">
                <span
                  x-title="parameters.iname"
                  x-content="parameters.ititle"
                />
              </keep-if>
              <div>
                <keep-if truthy="parameters.dialog===undefined">
                  <div>
                    Copy
                    <button
                      type="button"
                      x-copy='parameters["html-link"]'
                      title="Copy HTML link"
                    >
                      <code>&lt;a&gt;</code>
                    </button>
                    <button
                      type="button"
                      x-copy='parameters["markdown-link"]'
                      title="Copy Markdown link"
                    >
                      <code>[]()</code>
                    </button>
                    <button
                      type="button"
                      x-copy="parameters.ipath"
                      title="Copy path"
                    >
                      Path
                    </button>
                  </div>
                </keep-if>
                <keep-if truthy="parameters.dialog!==undefined">
                  <div>
                    Insert
                    <button
                      type="button"
                      x-insert='parameters["html-link"]'
                      title="Insert HTML link"
                    >
                      <code>&lt;a&gt;</code>
                    </button>
                    <button
                      type="button"
                      x-insert='parameters["markdown-link"]'
                      title="Insert Markdown link"
                    >
                      <code>[]()</code>
                    </button>
                    <button
                      type="button"
                      x-insert="parameters.ipath"
                      title="Insert path"
                    >
                      Path
                    </button>
                  </div>
                </keep-if>
              </div>
            </div>
          </li>
        </map-list>
      </ul>
    </keep-if>
    <drop-if truthy="parameters.query!==undefined">
      <p>Type a query and hit "Go" to see the results here</p>
    </drop-if>
  </body>
</html>
