<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Query Playground</title>
    <keep-if truthy="topLevelParameters.dialog!==undefined">
      <meta itemprop="nocontainer" />
    </keep-if>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <keep-if truthy="topLevelParameters.dialog!==undefined">
      <link
        rel="stylesheet"
        href="/system/global.css"
        type="text/css"
        media="screen"
      />

      <style>
        :root {
          font-size: 14px;
        }
        body {
          padding: var(--space-half);
          box-sizing: border-box;
        }
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          margin-block: var(--space-half);
          font-size: 1rem;
          font-weight: bold;
        }
      </style>
    </keep-if>

    <style>
      textarea {
        height: 3rem;
      }

      [copy-target-container]:has([copy]:hover) {
        [copy-target] {
          background-color: var(--bg-lighter);
        }
      }

      li:not(:last-child) {
        margin-bottom: var(--space-half);
      }
    </style>
    <script src="/system/scripts/copy-and-insert.js"></script>
    <form method="GET">
      <keep-if truthy="topLevelParameters.dialog!==undefined">
        <input type="hidden" name="select" value="body" />
        <input type="hidden" name="dialog" value="dialog" />
        <input
          type="hidden"
          name="contentPath"
          x-value="parameters.contentPath"
        />
      </keep-if>
      <textarea
        autofocus
        name="query"
        x-content="or(topLevelParameters.query,'')"
        placeholder="Temporal.Now.plainDateTimeISO()"
      >
      </textarea>
      <button type="submit" x-formaction="parameters.contentPath">Go</button>
    </form>
    <keep-if truthy="topLevelParameters.query!==undefined">
      <set- result="query(topLevelParameters.query)"> </set->
      <h2>Complete result</h2>
      <div copy-target-container>
        <pre
          x-content="topLevelParameters.result,(p)=>typeof p === 'string'?p:JSON.stringify(p,null,2),(p)=>`<code
            copy-target>${p}</code>`"
        ></pre>
        <div>
          <button type="button" copy>Copy</button>

          <keep-if truthy="topLevelParameters.dialog!==undefined">
            <button type="button" insert>Insert</button>
          </keep-if>
        </div>
      </div>
      <keep-if truthy="Array.isArray(topLevelParameters.result)">
        <h2>List view</h2>
        <ul>
          <map-list q="topLevelParameters.result" allow-one>
            <li copy-target-container>
              <div class="flex-row justify-between">
                <span copy-target x-content="parameters.currentListItem"></span>
                <div>
                  <button type="button" copy>Copy</button>
                  <button type="button" insert>Insert</button>
                </div>
              </div>
            </li>
          </map-list>
        </ul>
      </keep-if>
    </keep-if>
    <drop-if truthy="topLevelParameters.query!==undefined">
      <p>Type a query and hit "Go" to see the results here</p>
    </drop-if>
  </body>
</html>
