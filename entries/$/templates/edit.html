<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Edit Page</title>
    <meta name="description" content="Edit content here" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <style type="text/css" media="screen">
      /* Must be within <body> because of `select: body` parameter */
      textarea {
        height: 30rem;
        min-height: 10rem;
        resize: block;
      }

      form {
        position: relative;
      }

      button {
        max-width: max-content;
      }

      h1 {
        font-size: 1rem;
      }

      dialog {
        padding: 0;
        position: absolute;
        inset: unset; /* reset preset offset, upset */
        right: var(--space-phi);
        margin-top: var(--space-half);
        border: none;

        background-color: var(--bg);
        box-shadow: 0px 0px 12px -1px rgba(0, 0, 0, 0.48);
      }
      iframe {
        border: none;
        display: block; /* maybe this should be called a bframe, amiright? */
      }
    </style>
    <h1>
      Editing
      <keep-if truthy="parameters.contentParameters?.contentPath">
        <replace-with
          a
          x-href="parameters.contentParameters.contentPath"
          x-content="parameters.contentParameters.contentPath"
          >[filename] :-/</replace-with
        >
      </keep-if>
      <drop-if truthy="parameters.contentParameters?.contentPath">
        (Template)
      </drop-if>
    </h1>
    <drop-if truthy="parameters.contentParameters?.contentPath">
      You are viewing the edit page directly. Maybe you meant to
      <a href="?edit">edit this page</a>
      (edit the edit page)? Or if you wanted to edit another page, go to that
      page and add <code>?edit</code> to the end of the URL.
    </drop-if>
    <keep-if truthy="parameters.contentParameters?.contentPath">
      <form method="POST">
        <div>
          Toolbox

          <button
            type="button"
            title="Show Query Playground"
            onclick="{const d=document.querySelector('[query-playground]');d.open ? d.close() : d.show()}"
          >
            ?q=
          </button>
          <dialog query-playground closedby="none">
            <iframe
              title="Query Playground Widget"
              loading="lazy"
              src="/?contentPath=/$/templates/query.html&select=body"
            ></iframe>
          </dialog>
        </div>

        <!-- prettier-ignore -->
        <textarea name="content" spellcheck="false"><query-content q="render(parameters.contentParameters.contentPath,parameters.contentParameters)">Something went wrong :-/ the content you are attempting to edit should have apeared here</query-content></textarea
        >
        <slot name="keep" if="raw">
          <button type="submit" formaction="?raw">Save</button>
          <p>
            This isn't implemented correctly. Need to add <code>?raw</code> to
            query <code>q/query/contentParameters/contentPath</code>
          </p>
        </slot>
        <slot name="remove" if="raw">
          <replace-with
            button
            type="submit"
            x-formaction="parameters.contentParameters.contentPath"
            >Save</replace-with
          >
        </slot>
      </form>
    </keep-if>
  </body>
</html>
